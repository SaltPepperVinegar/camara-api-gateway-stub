# CAMARA API Stubs

This project implements stubbing for the [CAMARA APIs](https://camaraproject.org/)

## Why does this exist

## Architecture

[Prism](https://stoplight.io/open-source/prism) - OpenAPI mock server, used to deliver CAMARA API stubs that validate incoming requests and return example responses
[Keycloak](https://www.keycloak.org/) - OpenID Connect (OIDC) compliant Auth Server, used to simulate OIDC flows that protect CAMARA APIs
[nginx](https://nginx.org/en/) - Reverse proxy, simulates TLS
[Spring Cloud Gateway]() - an API gateway that exposes CAMARA APIs and enforces OIDC security according to CAMARA OpenAPI specifications

## Usage

### Prerequisites

This project assumes you have access to the following tools:

- [Docker](https://www.docker.com/) - consider installing [Docker Desktop](https://docs.docker.com/desktop/), other systems such as Podman are a available but this project has only been verified with Docker Desktop
- [Docker Compose](https://docs.docker.com/compose/) - a tool for running multi-container applications, used to simplify starting the stub services - installed with most Docker installations
- [uv](https://docs.astral.sh/uv/) - a package and project manager for Python, used to run a number of scripts that that configure the gateway
- [curl](https://curl.se/docs/manpage.html) - pre-installed on most OS, used in examples in this guide
- [jq](https://jqlang.org/) - a utility for working with JSON, used in examples in this guide to extract data from responses
- [make](https://www.gnu.org/software/make/manual/make.html) - a build tool, used to run custom scripts, such as fetching CAMARA API specifications, or preparing certificates for TLS
- [openssl](https://www.openssl.org/) - a utility for working with TLS, used to generate private keys and certificates
- a browser - any will do

> A note for Windows users
> This project assumes a unix-like environment, [Windows Subsystem for Linux (WSL)](https://learn.microsoft.com/en-us/windows/wsl/) is recommended. PRs welcome for Windows users that get this guide working outside WSL :).

#### Networking

You will need to add a number of hosts to your OS known hosts list - `/etc/hosts` on unix-like machines, add:

```shell
127.0.0.1 poochie.example.com
```

### [Day-1](https://octopus.com/blog/difference-between-day-0-1-2-operations) configuration

TLS certificates and API definitions are

OpenAPI v3 specifications for each CAMARA API can be accessed via the project's official [GitHub Organization](https://github.com/camaraproject/)

#### TLS

CAMARA APIs are protected by TLS and this project makes efforts to simulate that.

> A key limitation of this project is that the certificates generated by default are self signed, if you use these certificates you will need to add these certificates to the list of certificates trusted by your OS and also

### Start

```shell
docker compose up -d
```

Get an access token

```shell
export ACCESS_TOKEN=<access-token>
```

Providing the access token as bearer authorization, make a request to the Number Verification API

```shell
curl -ikX POST http://poochie.example.com/camara/number-verification/v1/verify -H "Authorization: Bearer ${ACCESS_TOKEN}" -d '{"phoneNumber": "+61234567890"}' -H "Content-Type: application/json"
```
